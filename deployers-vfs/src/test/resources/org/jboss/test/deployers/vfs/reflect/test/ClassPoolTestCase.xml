<deployment xmlns="urn:jboss:bean-deployer:2.0">

  <bean name="EarStructure" class="org.jboss.test.deployers.vfs.structure.ear.support.MockEarStructureDeployer"/>
  <bean name="WarStructure" class="org.jboss.test.deployers.vfs.structure.war.support.MockWarStructureDeployer"/>
  <bean name="WarClassLoader" class="org.jboss.test.deployers.vfs.reflect.support.MockWarClassLoaderDeployer"/>

  <bean name="ClassLoaderScopingPolicy" class="org.jboss.classpool.plugins.jbosscl.VFSClassLoaderDomainRegistry">
     <constructor factoryMethod="getInstance"/>
   </bean>

  <bean name="RegisterModuleCallback" class="org.jboss.classpool.plugins.jbosscl.RegisterModuleCallback">
     <constructor>
       <parameter><inject bean="ClassLoaderScopingPolicy"/></parameter>
     </constructor>
     <install method="addModuleRegistry" bean="ClassLoading" whenRequired="Start">
       <parameter><this/></parameter>
     </install>
     <uninstall method="removeModuleRegistry" bean="ClassLoading" whenRequired="Start">
       <parameter><this/></parameter>
     </uninstall>
  </bean>

  <bean name="ClassPoolFactory" class="org.jboss.classpool.plugins.jbosscl.JBossClDelegatingClassPoolFactory">
     <constructor>
        <parameter><inject bean="ClassLoaderScopingPolicy"/></parameter>
        <parameter><inject bean="RegisterModuleCallback"/></parameter>
     </constructor>
  </bean>

  <bean name="ClassPoolRepository" class="org.jboss.classpool.spi.ClassPoolRepository">
     <constructor factoryMethod="getInstance"/>
     <property name="classPoolFactory"><inject bean="ClassPoolFactory"/></property>
  </bean>

  <bean name="PoolFactoryInitializer" class="org.jboss.test.deployers.vfs.reflect.support.PoolFactoryInitializer">
     <constructor>
        <parameter><inject bean="ClassPoolRepository"/></parameter>
     </constructor>
  </bean>
  
</deployment>
